<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Project BTC</title>
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
	</head>
	<body>
		<h1>BitTorrent Tracker Cache</h1>
		<p>This service provides a generic peer list cache, inspired by <a href="https://web.archive.org/web/20250919064703/https://blog.lyc8503.net/post/pt-hack">this blog post</a>. Some features:</p>
		<ul>
			<li><b>Automagical Caching: </b>Just change the tracker URL in your torrent file, and this service manages everything for you.</li>
			<li><b>Tracker Aggregation: </b>This service uses <tt>info_hash</tt> to distinguish different torrents. All known peers for a torrent are reported, even if they come from different trackers.</li>
			<li><b>TTL: </b>You could set a custom time-to-live for the cache. This service forces a re-announcement once the cache is expired.</li>
			<li><b>Arbitrary Client Support: </b>You can leech using any client you like. This service guarantees a fake qBittorrent instance is used for connecting to the actual tracker.</li>
			<li><b>Privacy: </b>You do not show your real IP address to the actual tracker when using this service. Also, this service does not store your information like IP and passkeys. If you do not trust it, you could deploy your own instance from <a href="https://github.com/arielherself/btc">the codebase</a>.</li>
			<li><b>AI Free: </b>All code except the button on this page is handcrafted, and does not utilize AI in any form. If you are a fan of language models, you could close this tab now.</li>
		</ul>

		<h2>Usage</h2>
		<p>Upload your torrent below, then download the modified one. After that, add the new torrent to your BitTorrent client and start leeching.</p>

		<!-- Start of AI-generated code -->
		<input id="torrentFile" type="file" accept=".torrent" />
		<button id="uploadBtn">Upload</button>

		<div id="status" aria-live="polite"></div>

		<script>
		const fileInput = document.getElementById('torrentFile');
		const uploadBtn = document.getElementById('uploadBtn');
		const status = document.getElementById('status');

		function setStatus(text) { status.textContent = text; }

		async function getFilenameFromContentDisposition(header) {
			if (!header) return null;
			// try to parse filename="..." or filename*=UTF-8''...
			const filenameStar = /filename\*\s*=\s*([^;]+)/i.exec(header);
			if (filenameStar) {
				// e.g. filename*=UTF-8''modified.torrent or encoded form
				try {
					let val = filenameStar[1].trim();
					// remove surrounding quotes if any
					val = val.replace(/^"(.*)"$/, '$1');
					// split off charset'' if present
					const parts = val.split("''");
					return decodeURIComponent(parts.pop());
				} catch(e) { /* fallthrough */ }
			}
			const filename = /filename\s*=\s*"([^"]+)"|filename\s*=\s*([^;]+)/i.exec(header);
			if (filename) return (filename[1] || filename[2] || '').trim().replace(/^"(.*)"$/, '$1');
			return null;
		}

		uploadBtn.addEventListener('click', async () => {
			const file = fileInput.files && fileInput.files[0];
			if (!file) {
				setStatus('Please choose a .torrent file first.');
				return;
			}
			uploadBtn.disabled = true;
			setStatus('Uploading...');

			try {
				const form = new FormData();
				form.append('file', file);

				const resp = await fetch('https://tracker.submy.org/transform', {
					method: 'POST',
					body: form,
					// credentials/mode can be adjusted depending on server CORS requirements
					// mode: 'cors'
				});

				if (!resp.ok) {
					const text = await resp.text().catch(() => '');
					throw new Error(`Server returned ${resp.status} ${resp.statusText}${text ? ': ' + text : ''}`);
				}

				const blob = await resp.blob();

				// Determine filename from Content-Disposition if provided
				const cd = resp.headers.get('Content-Disposition');
				let outName = await getFilenameFromContentDisposition(cd);
				if (!outName) {
					// fallback to original name with "-modified"
					const original = file.name || 'torrent.torrent';
					outName = original.replace(/(\.torrent)?$/i, '') + '-modified.torrent';
				}

				// trigger download
				const url = URL.createObjectURL(blob);
				const a = document.createElement('a');
				a.href = url;
				a.download = outName;
				document.body.appendChild(a);
				a.click();
				a.remove();
				URL.revokeObjectURL(url);

				setStatus('Done â€” file downloaded: ' + outName);
			} catch (err) {
				console.error(err);
				setStatus('Error: ' + (err.message || err));
			} finally {
				uploadBtn.disabled = false;
			}
		});
		</script>
		<!-- End of AI-generated code -->

		<h2>Disclaimer</h2>
		<ul>
			<li>Your account could be banned for using this service. DYOR.</li>
			<li>This project exists simply because I am boring. If you think it is unethical, you could close this tab. But if you like it, please consider <a href="https://github.com/arielherself/btc">giving it a star</a>.</li>
		</ul>
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
	</body>
</html>
